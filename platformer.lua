-- title:  testing
-- author: desttinghim
-- desc:   trying out tic80
-- script: lua

-- Util
function enum(tbl)
 local len = #tbl
 for i=1,len do
  local v = tbl[i]
  tbl[v] = i
 end
 return tbl
end

-- Animation
F = enum{"INDEX","WAIT","STOP","LOOP"}
Anim = {
 still = function (i)
  return {
   {t=F.INDEX,v=i},
   {t=F.STOP}
  }
 end,
 
 simple = function(len, ilist)
  local a = {}
  for i,v in ipairs(ilist) do
   a[#a+1]={t=F.INDEX,v=v}
   a[#a+1]={t=F.WAIT,v=len}
  end
  a[#a+1]={t=F.LOOP}
  return a
 end
} -- End Anim

-- Actor
Actor = {
 new = function(tbl)
  tbl = setmetatable(tbl, {__index=Actor})
  tbl.index = tbl.index or 255
  tbl.x = tbl.x or 0
  tbl.y = tbl.y or 0
  tbl.w = tbl.w or 1
  tbl.h = tbl.h or 1
  tbl.scale = tbl.scale or 1
  tbl.rot = tbl.rot or 0
  tbl.anim = tbl.anim
  -- Internal state for anim
  tbl.next = 0
  tbl.frame = 1
  return tbl
 end,
 
 set_anim = function(self, a)
  if self.anim ~= a then
	  self.anim = a
	  self.next = 0
	  self.frame = 1
  end
 end,
} -- End Actor

-- Anim Lookup
anim={
 Anim.still(256),
 Anim.simple(15,{257,258,259,260}),
 Anim.still(261),
 Anim.still(262),
}

t=0
ecount=1
actor={
 Actor.new({index=256,x=0,y=0,anim=1})
}
controllable={[1]=true}
animation={
 {anim=1,next=0,frame=1},
}

function TIC()
 input()
	draw()
	t=t+1
end

function input()
 for i,v in pairs(controllable) do
	 if v then
			local a = actor[i]
			if btn(0) then 
			 a.y=a.y-1 a:set_anim(2)
			elseif btn(1) then 
			 a.y=a.y+1 a:set_anim(2)
			elseif btn(2) then 
			 a.x=a.x-1 a:set_anim(2) a.flip=1
			elseif btn(3) then 
			 a.x=a.x+1 a:set_anim(2) a.flip=0
   else 
    a:set_anim(1) 
   end
		end
	end
end

function draw()
	cls(13)
	map(0,0,30,17)
	print("HELLO LOUIS!",84,84)
	
	for i,act in ipairs(actor) do
		while act.anim ~= nil and act.next <= t do
			local a = anim[act.anim]
			local f = a[act.frame]
			if f.t == F.STOP then 
				act.anim = nil
				break
			elseif f.t == F.INDEX then 
				act.index = f.v
			elseif f.t == F.LOOP then
				act.frame = 0
			elseif f.t == F.WAIT then
			 act.next = t + f.v
			end
			act.frame = act.frame + 1
		end
		local transparent = 0
		spr(act.index,act.x,act.y,transparent,
		 act.scale,act.flip,act.rot,
			act.w,act.h)
 end
end
-- <TILES>
-- 018:00000000000000000000000000000000000c0000000000000cc00c0ccccccccc
-- 020:0cccccccccc0000cc0000c00c0000000c0000000cc0c0000cc000000c0000000
-- 021:ccccccc00000000c0000000c0000000c0000000c0000000c0000000c0000000c
-- 033:0000000c000000cc000000cc0000000c0000c00c000000cc000000cc0000000c
-- 035:c0000000c00c0000cc000000c0000000c00c0000c0000000cc000000cc000000
-- 036:c0000000c0000000c0000000c0000000c0000000c0000000c00000000ccccccc
-- 037:0000000c0000000c0000000c0000000c0000000c0000000c0000000cccccccc0
-- 050:cccccccc0c000c0c0000000000c0000000000000000000000000000000000000
-- 255:dccccccdcc2cc2cccc2cc2cccc2cc2cccc2cc2cccccccccccc2cc2ccdccccccd
-- </TILES>

-- <SPRITES>
-- 000:000cc000000cc00000cccc000cccccd00cccccd00cccccd000c00d0000c00d00
-- 001:000cc000000cc00000cccc0000cccc0000cccc0000cccc00000dc000000d0000
-- 002:000cc000000cc00000cccc0000cccc000dccccc000cccc0000d0c00000d0c000
-- 003:000cc000000cc00000cccc0000cccc0000cccc0000cccc00000c0d00000c0000
-- 004:000cc000000cc00000cccc000cccccd0c0cccc0d00cccc0000c00d0000c00d00
-- 005:000cc000000cc0000ccccc0dc0ccccd000cccc0000ccccd00cc000d000000000
-- 006:000cc000000cc0000cccccd0c0cccc0d00cccc0000ccccd000c000d000c00000
-- </SPRITES>

-- <MAP>
-- 001:000021212121212121212121212121212121212121212121212121210000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 002:001200000000000000000000000000000000000000000000000000003200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 003:001200000000000000000000000000000000000000000000000000003200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 004:001200000000000000000000000000000000000000000000000000003200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 005:001200000000000000000000000000000000000000000000000000003200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 006:001200000000000000000000000000000000000000000000000000003200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 007:001200000000000000000000000000000000000000000000000000003200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 008:001200000000000000000000000000000000000000000000000000003200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 009:001200000000000000000000000000000000000000000000000000003200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 010:001200000000000000000000000000000000000000000000000000003200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 011:001200000000000000000000000000000000000000000000000000003200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 012:001200000000000000000000000000000000000000000000000000003200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 013:001200000000000000000000000041510000000000000000000000003200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 014:001200000000000000000000412300005100000000000000000000003200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 015:000023232323232323232323000000000023232323232323232323230000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- </MAP>

-- <WAVES>
-- 000:00000000ffffffff00000000ffffffff
-- 001:0123456789abcdeffedcba9876543210
-- 002:0123456789abcdef0123456789abcdef
-- </WAVES>

-- <SFX>
-- 000:010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100300000000000
-- </SFX>

-- <PATTERNS>
-- 000:400018000000000000100000400018000000000000100000600018000000000000100000400018000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- </PATTERNS>

-- <TRACKS>
-- 000:100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- </TRACKS>

-- <FLAGS>
-- 000:00000000000000000000000000000000000010001010000000000000000000000010001010100000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- </FLAGS>

-- <PALETTE>
-- 000:1a1c2c5d275db13e53ef7d57ffcd75a7f07038b76425717929366f3b5dc941a6f673eff7f4f4f494b0c2566c86333c57
-- </PALETTE>

